syntax = "proto3";
import "google/protobuf/empty.proto";

package com.example.generated;
option java_multiple_files = true;

message ApiResponse{
  int32 code =1;
  string message =2;
}

message ProfileUser {
  string fullname  = 1;
  string bio       = 2;
}

message DisciplineRef {
  int64 id = 1;
  string name = 2;
}
message ProfileWorker {
  string degreeTitle  = 1;
  string unitName     = 2;
  repeated DisciplineRef disciplines = 3; // <-- NOWE
}

message ProfileAdmin {
  string unitName  = 1;
}

message ProfileView {
  ProfileUser user     = 1;
  ProfileWorker worker = 2;
  ProfileAdmin admin   = 3;
}

message GetProfileRequest {
  int64 userId = 1;
}

message GetProfileResponse {
  ProfileView profile = 1;
  ApiResponse response = 2;
}

message UpdateMyProfileRequest {
  int64 userId = 1;
  ProfileUser user     = 2;
  ProfileWorker worker = 3;
  ProfileAdmin admin   = 4;
}

message UpdateMyProfileResponse {
  ProfileView profile = 1;
  ApiResponse response = 2;
}

message SeeSomeoneProfileRequest{
  int64 userId = 1;
}

enum RoleName {
  ROLE_USER = 0;
  ROLE_WORKER = 1;
  ROLE_ADMIN = 2;
}



/* =========================
   NOWE: worker ↔ disciplines
   ========================= */
message ListWorkerDisciplinesRequest {
  int64 userId = 1;
}

message ListWorkerDisciplinesResponse {
  repeated DisciplineRef disciplines = 1;
  ApiResponse response = 2;
}

message AddWorkerDisciplineRequest {
  int64 userId = 1;
  int64 disciplineId = 2;
}

message RemoveWorkerDisciplineRequest {
  int64 userId = 1;
  int64 disciplineId = 2;
}

message ListAllProfilesRequest {
  string fullname = 1; // wyszukiwanie po imię+nazwisko
  int32 page = 2;
  int32 size = 3;
  string sortBy = 4;   // np. "userId" albo "fullname"
  string sortDir = 5;  // "asc" / "desc"
}

message AdminProfileListItem {
  int64 userId = 1;
  string fullname = 2;

  bool hasWorker = 3;
  bool hasAdmin = 4;

  // opcjonalnie do tabelki:
  string workerDegreeTitle = 5;
  string workerUnitName = 6;
  string adminUnitName = 7;
}

message ListAllProfilesResponse {
  repeated AdminProfileListItem items = 1;
  int64 totalElements = 2;
  int32 totalPages = 3;
  ApiResponse response = 4;
}


/* =========================
   NOWE: statement / slot limits
   ========================= */
message WorkerStatement {
  int64 userId = 1;
  int64 disciplineId = 2;
  int32 evalYear = 3;

  double fte = 4;
  double sharePercent = 5;
  double slotInDiscipline = 6;

  double maxSlots = 7;
  double maxMonoSlots = 8;
}

message GetOrCreateStatementRequest {
  int64 userId = 1;
  int64 disciplineId = 2;
  int32 evalYear = 3;
}

message GetOrCreateStatementResponse {
  WorkerStatement statement = 1;
  ApiResponse response = 2;
}

message AdminInitStatementsForYearRequest {
  int32 evalYear = 1;
}

message AdminInitStatementsForYearResponse {
  int32 evalYear = 1;
  int64 createdCount = 2;
  ApiResponse response = 3;
}


message ListDisciplineResponse {
  repeated DisciplineRef disciplines = 1;
  ApiResponse response = 2;
}


service ProfilesService{
  rpc GetMyProfile(GetProfileRequest) returns (GetProfileResponse);
  rpc UpdateMyProfile(UpdateMyProfileRequest) returns (UpdateMyProfileResponse);
  rpc SeeSomeoneProfile(SeeSomeoneProfileRequest) returns (GetProfileResponse);

  // NOWE:
  rpc ListWorkerDisciplines(ListWorkerDisciplinesRequest) returns (ListWorkerDisciplinesResponse);
  rpc AddWorkerDiscipline(AddWorkerDisciplineRequest) returns (ListWorkerDisciplinesResponse);
  rpc RemoveWorkerDiscipline(RemoveWorkerDisciplineRequest) returns (ListWorkerDisciplinesResponse);

  rpc GetOrCreateStatement(GetOrCreateStatementRequest) returns (GetOrCreateStatementResponse);
  rpc AdminInitStatementsForYear(AdminInitStatementsForYearRequest) returns (AdminInitStatementsForYearResponse);

  rpc ListAllProfiles(ListAllProfilesRequest) returns (ListAllProfilesResponse);
  rpc ListDisciplines(google.protobuf.Empty) returns (ListDisciplineResponse);
}
